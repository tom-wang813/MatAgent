{"ast":null,"code":"export const sendMessage = (message, conversationId, onNewStep, onError, onOpen) => {\n  const backendUrl = process.env.REACT_APP_BACKEND_URL || 'http://localhost:8000/api';\n  const traceId = `trace-${Date.now()}-${Math.random().toString(36).substring(2, 15)}`;\n\n  // Construct URL with query parameters for GET request with EventSource\n  const url = new URL(`${backendUrl}/chat`);\n  url.searchParams.append('message', message);\n  if (conversationId) {\n    url.searchParams.append('conversation_uuid', conversationId);\n  }\n  // EventSource does not support custom headers directly for GET requests.\n  // If X-Trace-ID is critical, it needs to be passed as a query parameter or handled differently.\n  // For now, we'll omit it as it's primarily for backend logging.\n\n  const eventSource = new EventSource(url.toString());\n  eventSource.onopen = () => {\n    console.log('SSE connection opened.');\n    if (onOpen) onOpen();\n  };\n  eventSource.onmessage = event => {\n    if (event.data) {\n      try {\n        const step = JSON.parse(event.data);\n        onNewStep(step);\n      } catch (e) {\n        console.error('Error parsing SSE message:', e, 'Data:', event.data);\n        if (onError) onError(e);\n      }\n    }\n  };\n  eventSource.onerror = err => {\n    console.error('SSE error:', err);\n    eventSource.close();\n    if (onError) onError(err);\n  };\n\n  // Return the EventSource instance so it can be closed by the caller if needed\n  return eventSource;\n};","map":{"version":3,"names":["sendMessage","message","conversationId","onNewStep","onError","onOpen","backendUrl","process","env","REACT_APP_BACKEND_URL","traceId","Date","now","Math","random","toString","substring","url","URL","searchParams","append","eventSource","EventSource","onopen","console","log","onmessage","event","data","step","JSON","parse","e","error","onerror","err","close"],"sources":["/Users/wang-work/matagent/frontend/src/utils/api.js"],"sourcesContent":["export const sendMessage = (message, conversationId, onNewStep, onError, onOpen) => {\n  const backendUrl = process.env.REACT_APP_BACKEND_URL || 'http://localhost:8000/api';\n  const traceId = `trace-${Date.now()}-${Math.random().toString(36).substring(2, 15)}`;\n\n  // Construct URL with query parameters for GET request with EventSource\n  const url = new URL(`${backendUrl}/chat`);\n  url.searchParams.append('message', message);\n  if (conversationId) {\n    url.searchParams.append('conversation_uuid', conversationId);\n  }\n  // EventSource does not support custom headers directly for GET requests.\n  // If X-Trace-ID is critical, it needs to be passed as a query parameter or handled differently.\n  // For now, we'll omit it as it's primarily for backend logging.\n\n  const eventSource = new EventSource(url.toString());\n\n  eventSource.onopen = () => {\n    console.log('SSE connection opened.');\n    if (onOpen) onOpen();\n  };\n\n  eventSource.onmessage = (event) => {\n    if (event.data) {\n      try {\n        const step = JSON.parse(event.data);\n        onNewStep(step);\n      } catch (e) {\n        console.error('Error parsing SSE message:', e, 'Data:', event.data);\n        if (onError) onError(e);\n      }\n    }\n  };\n\n  eventSource.onerror = (err) => {\n    console.error('SSE error:', err);\n    eventSource.close();\n    if (onError) onError(err);\n  };\n\n  // Return the EventSource instance so it can be closed by the caller if needed\n  return eventSource;\n};\n"],"mappings":"AAAA,OAAO,MAAMA,WAAW,GAAGA,CAACC,OAAO,EAAEC,cAAc,EAAEC,SAAS,EAAEC,OAAO,EAAEC,MAAM,KAAK;EAClF,MAAMC,UAAU,GAAGC,OAAO,CAACC,GAAG,CAACC,qBAAqB,IAAI,2BAA2B;EACnF,MAAMC,OAAO,GAAG,SAASC,IAAI,CAACC,GAAG,CAAC,CAAC,IAAIC,IAAI,CAACC,MAAM,CAAC,CAAC,CAACC,QAAQ,CAAC,EAAE,CAAC,CAACC,SAAS,CAAC,CAAC,EAAE,EAAE,CAAC,EAAE;;EAEpF;EACA,MAAMC,GAAG,GAAG,IAAIC,GAAG,CAAC,GAAGZ,UAAU,OAAO,CAAC;EACzCW,GAAG,CAACE,YAAY,CAACC,MAAM,CAAC,SAAS,EAAEnB,OAAO,CAAC;EAC3C,IAAIC,cAAc,EAAE;IAClBe,GAAG,CAACE,YAAY,CAACC,MAAM,CAAC,mBAAmB,EAAElB,cAAc,CAAC;EAC9D;EACA;EACA;EACA;;EAEA,MAAMmB,WAAW,GAAG,IAAIC,WAAW,CAACL,GAAG,CAACF,QAAQ,CAAC,CAAC,CAAC;EAEnDM,WAAW,CAACE,MAAM,GAAG,MAAM;IACzBC,OAAO,CAACC,GAAG,CAAC,wBAAwB,CAAC;IACrC,IAAIpB,MAAM,EAAEA,MAAM,CAAC,CAAC;EACtB,CAAC;EAEDgB,WAAW,CAACK,SAAS,GAAIC,KAAK,IAAK;IACjC,IAAIA,KAAK,CAACC,IAAI,EAAE;MACd,IAAI;QACF,MAAMC,IAAI,GAAGC,IAAI,CAACC,KAAK,CAACJ,KAAK,CAACC,IAAI,CAAC;QACnCzB,SAAS,CAAC0B,IAAI,CAAC;MACjB,CAAC,CAAC,OAAOG,CAAC,EAAE;QACVR,OAAO,CAACS,KAAK,CAAC,4BAA4B,EAAED,CAAC,EAAE,OAAO,EAAEL,KAAK,CAACC,IAAI,CAAC;QACnE,IAAIxB,OAAO,EAAEA,OAAO,CAAC4B,CAAC,CAAC;MACzB;IACF;EACF,CAAC;EAEDX,WAAW,CAACa,OAAO,GAAIC,GAAG,IAAK;IAC7BX,OAAO,CAACS,KAAK,CAAC,YAAY,EAAEE,GAAG,CAAC;IAChCd,WAAW,CAACe,KAAK,CAAC,CAAC;IACnB,IAAIhC,OAAO,EAAEA,OAAO,CAAC+B,GAAG,CAAC;EAC3B,CAAC;;EAED;EACA,OAAOd,WAAW;AACpB,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}