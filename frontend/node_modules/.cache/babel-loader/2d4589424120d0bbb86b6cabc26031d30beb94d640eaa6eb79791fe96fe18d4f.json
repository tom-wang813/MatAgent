{"ast":null,"code":"var _jsxFileName = \"/Users/wang-work/matagent/frontend/src/components/ChatWindow.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { useState, useRef, useEffect } from 'react';\nimport { Box, TextField, Button, Typography, CircularProgress, Paper, Avatar, Chip } from '@mui/material';\nimport SendIcon from '@mui/icons-material/Send';\nimport SmartToyIcon from '@mui/icons-material/SmartToy';\nimport PersonIcon from '@mui/icons-material/Person';\nimport ErrorOutlineIcon from '@mui/icons-material/ErrorOutline';\nimport InfoOutlinedIcon from '@mui/icons-material/InfoOutlined';\nimport ExpandMoreIcon from '@mui/icons-material/ExpandMore';\nimport ExpandLessIcon from '@mui/icons-material/ExpandLess';\nimport ReactMarkdown from 'react-markdown';\nimport remarkMath from 'remark-math';\nimport rehypeKatex from 'rehype-katex';\nimport 'katex/dist/katex.min.css'; // Import KaTeX CSS\nimport ToolCallDisplay from './ToolCallDisplay';\nimport { sendMessage } from '../utils/api'; // Import sendMessage from api.js\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst MAX_TOOL_OUTPUT_LENGTH = 200; // Define max length for tool output display\n\n// Helper function to group agent steps into logical turns\nconst groupAgentSteps = steps => {\n  const grouped = [];\n  let currentGroup = null;\n  steps.forEach(step => {\n    if (step.type === 'thought') {\n      if (currentGroup && (currentGroup.tool_calls.length > 0 || currentGroup.tool_output)) {\n        grouped.push(currentGroup);\n      }\n      currentGroup = {\n        thought: step.content,\n        tool_calls: [],\n        tool_output: null\n      };\n    } else if (step.type === 'tool_calls') {\n      if (!currentGroup) {\n        currentGroup = {\n          thought: null,\n          tool_calls: [],\n          tool_output: null\n        };\n      }\n      currentGroup.tool_calls = currentGroup.tool_calls.concat(step.content); // step.content is now the tool_calls array\n    } else if (step.type === 'tool_output') {\n      if (!currentGroup) {\n        currentGroup = {\n          thought: null,\n          tool_calls: [],\n          tool_output: null\n        };\n      }\n      currentGroup.tool_output = step.content.output; // step.content is now the tool_output object\n      grouped.push(currentGroup); // Tool output usually marks the end of a step\n      currentGroup = null; // Reset for next group\n    } else if (step.type === 'final_answer') {\n      if (currentGroup) {\n        grouped.push(currentGroup);\n      }\n      // Final answer is handled separately, not grouped as a step\n    }\n  });\n  if (currentGroup) {\n    grouped.push(currentGroup);\n  }\n  return grouped;\n};\nconst ToolOutputContent = ({\n  output\n}) => {\n  _s();\n  const [showFull, setShowFull] = useState(false);\n  const isLong = output && output.length > MAX_TOOL_OUTPUT_LENGTH;\n  const displayedOutput = isLong && !showFull ? output.substring(0, MAX_TOOL_OUTPUT_LENGTH) + '...' : output;\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(Typography, {\n      component: \"div\",\n      sx: {\n        mt: 1\n      },\n      children: /*#__PURE__*/_jsxDEV(ReactMarkdown, {\n        children: displayedOutput\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 64,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 63,\n      columnNumber: 7\n    }, this), isLong && /*#__PURE__*/_jsxDEV(Button, {\n      onClick: () => setShowFull(!showFull),\n      size: \"small\",\n      endIcon: showFull ? /*#__PURE__*/_jsxDEV(ExpandLessIcon, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 70,\n        columnNumber: 31\n      }, this) : /*#__PURE__*/_jsxDEV(ExpandMoreIcon, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 70,\n        columnNumber: 52\n      }, this),\n      sx: {\n        mt: 0.5\n      } // Adjusted margin top for consistency\n      ,\n      children: showFull ? 'Show Less' : 'Show More'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 67,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true);\n};\n_s(ToolOutputContent, \"pKhLrGiqJ/shax9lT5YShYWwMm0=\");\n_c = ToolOutputContent;\nconst ChatWindow = ({\n  conversation,\n  onSendMessage,\n  onUpdateTitle,\n  isLoading,\n  setIsLoading,\n  onUpdateConversationUuid // New prop to update conversation_uuid\n}) => {\n  _s2();\n  const [inputValue, setInputValue] = useState('');\n  const [currentAssistantMessage, setCurrentAssistantMessage] = useState(null);\n  const eventSourceRef = useRef(null); // To store the EventSource instance\n  const messagesEndRef = useRef(null);\n  const textareaRef = useRef(null);\n  const [currentConversationUuid, setCurrentConversationUuid] = useState((conversation === null || conversation === void 0 ? void 0 : conversation.uuid) || null); // New state for conversation_uuid\n\n  useEffect(() => {\n    if (conversation !== null && conversation !== void 0 && conversation.uuid) {\n      setCurrentConversationUuid(conversation.uuid);\n    }\n  }, [conversation === null || conversation === void 0 ? void 0 : conversation.uuid]);\n  const scrollToBottom = () => {\n    var _messagesEndRef$curre;\n    (_messagesEndRef$curre = messagesEndRef.current) === null || _messagesEndRef$curre === void 0 ? void 0 : _messagesEndRef$curre.scrollIntoView({\n      behavior: 'smooth'\n    });\n  };\n  useEffect(() => {\n    scrollToBottom();\n  }, [conversation === null || conversation === void 0 ? void 0 : conversation.messages, currentAssistantMessage]);\n  const handleKeyPress = e => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSubmit(e);\n    }\n  };\n  const handleSubmit = async e => {\n    e.preventDefault();\n    if (!inputValue.trim() || isLoading || !conversation) return;\n    const userMessage = {\n      id: Date.now().toString(),\n      type: 'user',\n      content: inputValue.trim(),\n      timestamp: new Date().toISOString()\n    };\n    onSendMessage(conversation.id, userMessage);\n    if (conversation.messages.length === 0) {\n      const title = inputValue.trim().length > 30 ? inputValue.trim().substring(0, 30) + '...' : inputValue.trim();\n      onUpdateTitle(conversation.id, title);\n    }\n    const currentInput = inputValue;\n    setInputValue('');\n    setIsLoading(true);\n\n    // Initialize a new assistant message for streaming\n    const newAssistantMessage = {\n      id: (Date.now() + 1).toString(),\n      type: 'assistant',\n      content: '',\n      timestamp: new Date().toISOString(),\n      agent_steps: [],\n      status: 'pending'\n    };\n    setCurrentAssistantMessage(newAssistantMessage);\n\n    // Close any existing EventSource connection before starting a new one\n    if (eventSourceRef.current) {\n      eventSourceRef.current.close();\n    }\n    try {\n      eventSourceRef.current = sendMessage(currentInput, currentConversationUuid, step => {\n        // onNewStep callback\n        setCurrentAssistantMessage(prev => {\n          // Ensure prev is not null before spreading\n          const updatedMessage = prev ? {\n            ...prev\n          } : {\n            id: (Date.now() + 1).toString(),\n            type: 'assistant',\n            content: '',\n            timestamp: new Date().toISOString(),\n            agent_steps: [],\n            status: 'pending'\n          };\n          if (step.type === 'conversation_info') {\n            if (step.conversation_uuid) {\n              setCurrentConversationUuid(step.conversation_uuid);\n              onUpdateConversationUuid(conversation.id, step.conversation_uuid);\n            }\n          } else if (step.type === 'text_chunk') {\n            updatedMessage.content += step.content;\n          } else if (step.type === 'final_answer') {\n            updatedMessage.content = step.content;\n            updatedMessage.status = 'success';\n          } else if (step.type === 'error') {\n            updatedMessage.content = step.content;\n            updatedMessage.status = 'error';\n          } else if (step.type === 'end') {\n            // This marks the end of the stream\n            updatedMessage.status = updatedMessage.status === 'error' ? 'error' : 'success'; // Preserve error status if any\n            setIsLoading(false);\n            if (eventSourceRef.current) {\n              eventSourceRef.current.close();\n            }\n          } else {\n            // For thought, tool_calls, tool_output, append to agent_steps\n            updatedMessage.agent_steps = [...updatedMessage.agent_steps, step];\n          }\n          return updatedMessage;\n        });\n      }, error => {\n        // onError callback\n        console.error('Error during streaming message:', error);\n        setCurrentAssistantMessage(prev => ({\n          ...prev,\n          content: `抱歉，发生了错误：${error.message || '未知错误'}。请稍后再试。`,\n          status: 'error'\n        }));\n        setIsLoading(false); // Stop loading on error\n      }, () => {\n        // onOpen callback\n        // Optional: handle connection open\n        console.log('SSE connection opened successfully.');\n      });\n    } catch (error) {\n      console.error('Error initiating streaming message:', error);\n      setCurrentAssistantMessage(prev => ({\n        ...prev,\n        content: `抱歉，无法启动对话：${error.message || '未知错误'}。请稍后再试。`,\n        status: 'error'\n      }));\n      setIsLoading(false);\n    } finally {\n      // The EventSource will be closed by the onError or when the stream naturally ends.\n      // We set isLoading to false when the 'end' signal is received or on error.\n      // The 'end' signal handling needs to be inside onNewStep for type 'end'.\n    }\n  };\n\n  // Effect to close EventSource when component unmounts\n  useEffect(() => {\n    return () => {\n      if (eventSourceRef.current) {\n        eventSourceRef.current.close();\n      }\n    };\n  }, []);\n\n  // Effect to add the completed assistant message to conversation messages\n  useEffect(() => {\n    // Only add if currentAssistantMessage exists, is not loading, and has a final status\n    if (currentAssistantMessage && !isLoading && (currentAssistantMessage.status === 'success' || currentAssistantMessage.status === 'error')) {\n      onSendMessage(conversation.id, currentAssistantMessage);\n      setCurrentAssistantMessage(null); // Clear current message\n    }\n  }, [isLoading, currentAssistantMessage, conversation, onSendMessage]);\n  const adjustTextareaHeight = () => {\n    const textarea = textareaRef.current;\n    if (textarea) {\n      textarea.style.height = 'auto';\n      textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';\n    }\n  };\n  useEffect(() => {\n    adjustTextareaHeight();\n  }, [inputValue]);\n  const formatTime = timestamp => {\n    return new Date(timestamp).toLocaleTimeString('zh-CN', {\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  };\n  if (!conversation) {\n    return /*#__PURE__*/_jsxDEV(Box, {\n      sx: {\n        flexGrow: 1,\n        display: 'flex',\n        flexDirection: 'column',\n        justifyContent: 'center',\n        alignItems: 'center',\n        p: 3,\n        textAlign: 'center',\n        color: 'text.secondary'\n      },\n      children: [/*#__PURE__*/_jsxDEV(SmartToyIcon, {\n        sx: {\n          fontSize: 80,\n          mb: 2\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 277,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Typography, {\n        variant: \"h5\",\n        component: \"h3\",\n        gutterBottom: true,\n        children: \"\\u6B22\\u8FCE\\u4F7F\\u7528 BioaGen Agent\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 278,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Typography, {\n        variant: \"body1\",\n        sx: {\n          maxWidth: 500\n        },\n        children: \"\\u8FD9\\u662F\\u4E00\\u4E2A\\u57FA\\u4E8EAI\\u7684\\u751F\\u7269\\u5206\\u5B50\\u5206\\u6790\\u52A9\\u624B\\u3002\\u60A8\\u53EF\\u4EE5\\u8BE2\\u95EE\\u6709\\u5173\\u5206\\u5B50\\u7ED3\\u6784\\u3001\\u6027\\u8D28\\u9884\\u6D4B\\u3001 \\u5316\\u5B66\\u53CD\\u5E94\\u7B49\\u76F8\\u5173\\u95EE\\u9898\\u3002\\u70B9\\u51FB\\u5DE6\\u4FA7\\\"\\u65B0\\u5EFA\\u5BF9\\u8BDD\\\"\\u5F00\\u59CB\\u60A8\\u7684\\u5206\\u6790\\u4E4B\\u65C5\\u3002\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 281,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 267,\n      columnNumber: 7\n    }, this);\n  }\n  return /*#__PURE__*/_jsxDEV(Box, {\n    sx: {\n      flexGrow: 1,\n      display: 'flex',\n      flexDirection: 'column',\n      height: '100%',\n      overflow: 'hidden'\n    },\n    children: [/*#__PURE__*/_jsxDEV(Box, {\n      sx: {\n        p: 2,\n        borderBottom: '1px solid',\n        borderColor: 'divider'\n      },\n      children: /*#__PURE__*/_jsxDEV(Typography, {\n        variant: \"h6\",\n        children: conversation.title\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 298,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 297,\n      columnNumber: 7\n    }, this), conversation.available_tools && conversation.available_tools.length > 0 && /*#__PURE__*/_jsxDEV(Box, {\n      sx: {\n        p: 2,\n        bgcolor: 'action.hover',\n        borderBottom: '1px solid',\n        borderColor: 'divider'\n      },\n      children: [/*#__PURE__*/_jsxDEV(Typography, {\n        variant: \"subtitle2\",\n        gutterBottom: true,\n        children: \"Available Tools:\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 303,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(Box, {\n        component: \"ul\",\n        sx: {\n          listStyle: 'none',\n          p: 0,\n          m: 0\n        },\n        children: conversation.available_tools.map((tool, index) => /*#__PURE__*/_jsxDEV(\"li\", {\n          children: /*#__PURE__*/_jsxDEV(Chip, {\n            label: `${tool.function.name}: ${tool.function.description}`,\n            size: \"small\",\n            sx: {\n              mb: 0.5\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 307,\n            columnNumber: 17\n          }, this)\n        }, index, false, {\n          fileName: _jsxFileName,\n          lineNumber: 306,\n          columnNumber: 15\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 304,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 302,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(Box, {\n      sx: {\n        flexGrow: 1,\n        overflowY: 'auto',\n        p: 2\n      },\n      children: [conversation.messages.map(message => /*#__PURE__*/_jsxDEV(Box, {\n        sx: {\n          display: 'flex',\n          mb: 2,\n          justifyContent: message.type === 'user' ? 'flex-end' : 'flex-start'\n        },\n        children: [message.type === 'assistant' && /*#__PURE__*/_jsxDEV(Avatar, {\n          sx: {\n            bgcolor: 'primary.main',\n            mr: 1\n          },\n          children: /*#__PURE__*/_jsxDEV(SmartToyIcon, {\n            fontSize: \"small\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 322,\n            columnNumber: 63\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 322,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(Paper, {\n          elevation: 1,\n          sx: {\n            p: 1,\n            borderRadius: 1,\n            maxWidth: '70%',\n            bgcolor: message.type === 'user' ? 'primary.light' : 'background.paper',\n            color: message.type === 'user' ? 'primary.contrastText' : 'text.primary'\n          },\n          children: [message.agent_steps && message.agent_steps.length > 0 && /*#__PURE__*/_jsxDEV(Box, {\n            sx: {\n              mb: 1\n            },\n            children: groupAgentSteps(message.agent_steps).map((stepGroup, groupIndex) => /*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                mb: 1,\n                p: 1,\n                bgcolor: 'grey.50',\n                borderRadius: 1\n              },\n              children: [/*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"subtitle2\",\n                children: [\"\\u6B65\\u9AA4 \", groupIndex + 1]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 335,\n                columnNumber: 23\n              }, this), stepGroup.thought && /*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"body2\",\n                sx: {\n                  mt: 0.5\n                },\n                children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                  children: \"Agent Thought:\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 338,\n                  columnNumber: 27\n                }, this), \" \", /*#__PURE__*/_jsxDEV(ReactMarkdown, {\n                  children: stepGroup.thought\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 338,\n                  columnNumber: 59\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 337,\n                columnNumber: 25\n              }, this), stepGroup.tool_calls && stepGroup.tool_calls.length > 0 && /*#__PURE__*/_jsxDEV(Box, {\n                sx: {\n                  mt: 0.5\n                },\n                children: [/*#__PURE__*/_jsxDEV(Typography, {\n                  variant: \"body2\",\n                  children: /*#__PURE__*/_jsxDEV(\"strong\", {\n                    children: \"Tool Calls:\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 343,\n                    columnNumber: 55\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 343,\n                  columnNumber: 27\n                }, this), /*#__PURE__*/_jsxDEV(ToolCallDisplay, {\n                  toolCalls: stepGroup.tool_calls\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 344,\n                  columnNumber: 27\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 342,\n                columnNumber: 25\n              }, this), stepGroup.tool_output && /*#__PURE__*/_jsxDEV(Box, {\n                sx: {\n                  mt: 0.5\n                },\n                children: [/*#__PURE__*/_jsxDEV(Typography, {\n                  variant: \"body2\",\n                  children: /*#__PURE__*/_jsxDEV(\"strong\", {\n                    children: \"Tool Output:\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 349,\n                    columnNumber: 55\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 349,\n                  columnNumber: 27\n                }, this), /*#__PURE__*/_jsxDEV(ToolOutputContent, {\n                  output: JSON.stringify(stepGroup.tool_output)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 350,\n                  columnNumber: 27\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 348,\n                columnNumber: 25\n              }, this)]\n            }, groupIndex, true, {\n              fileName: _jsxFileName,\n              lineNumber: 334,\n              columnNumber: 21\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 332,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(Typography, {\n            component: \"div\",\n            children: /*#__PURE__*/_jsxDEV(ReactMarkdown, {\n              remarkPlugins: [remarkMath],\n              rehypePlugins: [rehypeKatex],\n              children: message.content\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 358,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 357,\n            columnNumber: 15\n          }, this), message.status && message.status !== 'success' && /*#__PURE__*/_jsxDEV(Chip, {\n            icon: message.status === 'error' ? /*#__PURE__*/_jsxDEV(ErrorOutlineIcon, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 367,\n              columnNumber: 54\n            }, this) : /*#__PURE__*/_jsxDEV(InfoOutlinedIcon, {}, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 367,\n              columnNumber: 77\n            }, this),\n            label: message.status === 'error' ? '执行失败' : '部分成功',\n            size: \"small\",\n            color: message.status === 'error' ? 'error' : 'warning',\n            sx: {\n              mt: 1\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 366,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(Typography, {\n            variant: \"caption\",\n            color: \"text.secondary\",\n            sx: {\n              display: 'block',\n              mt: 0.5\n            },\n            children: formatTime(message.timestamp)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 375,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 324,\n          columnNumber: 13\n        }, this), message.type === 'user' && /*#__PURE__*/_jsxDEV(Avatar, {\n          sx: {\n            bgcolor: 'secondary.main',\n            ml: 1\n          },\n          children: /*#__PURE__*/_jsxDEV(PersonIcon, {\n            fontSize: \"small\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 380,\n            columnNumber: 65\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 380,\n          columnNumber: 15\n        }, this)]\n      }, message.id, true, {\n        fileName: _jsxFileName,\n        lineNumber: 316,\n        columnNumber: 11\n      }, this)), currentAssistantMessage && /*#__PURE__*/_jsxDEV(Box, {\n        sx: {\n          display: 'flex',\n          mb: 2,\n          justifyContent: 'flex-start'\n        },\n        children: [/*#__PURE__*/_jsxDEV(Avatar, {\n          sx: {\n            bgcolor: 'primary.main',\n            mr: 1\n          },\n          children: /*#__PURE__*/_jsxDEV(SmartToyIcon, {\n            fontSize: \"small\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 392,\n            columnNumber: 61\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 392,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(Paper, {\n          elevation: 1,\n          sx: {\n            p: 1,\n            borderRadius: 1,\n            maxWidth: '70%',\n            bgcolor: 'background.paper',\n            color: 'text.primary'\n          },\n          children: [currentAssistantMessage.agent_steps && currentAssistantMessage.agent_steps.length > 0 && /*#__PURE__*/_jsxDEV(Box, {\n            sx: {\n              mb: 1\n            },\n            children: groupAgentSteps(currentAssistantMessage.agent_steps).map((stepGroup, groupIndex) => /*#__PURE__*/_jsxDEV(Box, {\n              sx: {\n                mb: 1,\n                p: 1,\n                bgcolor: 'grey.50',\n                borderRadius: 1\n              },\n              children: [/*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"subtitle2\",\n                children: [\"\\u6B65\\u9AA4 \", groupIndex + 1]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 404,\n                columnNumber: 23\n              }, this), stepGroup.thought && /*#__PURE__*/_jsxDEV(Typography, {\n                variant: \"body2\",\n                sx: {\n                  mt: 0.5\n                },\n                children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                  children: \"Agent Thought:\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 407,\n                  columnNumber: 27\n                }, this), \" \", /*#__PURE__*/_jsxDEV(ReactMarkdown, {\n                  children: stepGroup.thought\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 407,\n                  columnNumber: 59\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 406,\n                columnNumber: 25\n              }, this), stepGroup.tool_calls && stepGroup.tool_calls.length > 0 && /*#__PURE__*/_jsxDEV(Box, {\n                sx: {\n                  mt: 0.5\n                },\n                children: [/*#__PURE__*/_jsxDEV(Typography, {\n                  variant: \"body2\",\n                  children: /*#__PURE__*/_jsxDEV(\"strong\", {\n                    children: \"Tool Calls:\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 412,\n                    columnNumber: 55\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 412,\n                  columnNumber: 27\n                }, this), /*#__PURE__*/_jsxDEV(ToolCallDisplay, {\n                  toolCalls: stepGroup.tool_calls\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 413,\n                  columnNumber: 27\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 411,\n                columnNumber: 25\n              }, this), stepGroup.tool_output && /*#__PURE__*/_jsxDEV(Box, {\n                sx: {\n                  mt: 0.5\n                },\n                children: [/*#__PURE__*/_jsxDEV(Typography, {\n                  variant: \"body2\",\n                  children: /*#__PURE__*/_jsxDEV(\"strong\", {\n                    children: \"Tool Output:\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 418,\n                    columnNumber: 55\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 418,\n                  columnNumber: 27\n                }, this), /*#__PURE__*/_jsxDEV(ToolOutputContent, {\n                  output: JSON.stringify(stepGroup.tool_output)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 419,\n                  columnNumber: 27\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 417,\n                columnNumber: 25\n              }, this)]\n            }, groupIndex, true, {\n              fileName: _jsxFileName,\n              lineNumber: 403,\n              columnNumber: 21\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 401,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(Typography, {\n            component: \"div\",\n            children: /*#__PURE__*/_jsxDEV(ReactMarkdown, {\n              remarkPlugins: [remarkMath],\n              rehypePlugins: [rehypeKatex],\n              children: currentAssistantMessage.content\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 427,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 426,\n            columnNumber: 15\n          }, this), isLoading && /*#__PURE__*/_jsxDEV(CircularProgress, {\n            size: 20,\n            sx: {\n              mt: 1\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 433,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 393,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 387,\n        columnNumber: 11\n      }, this), isLoading && !currentAssistantMessage && /*#__PURE__*/_jsxDEV(Box, {\n        sx: {\n          display: 'flex',\n          mb: 2,\n          justifyContent: 'flex-start'\n        },\n        children: [/*#__PURE__*/_jsxDEV(Avatar, {\n          sx: {\n            bgcolor: 'primary.main',\n            mr: 1\n          },\n          children: /*#__PURE__*/_jsxDEV(SmartToyIcon, {\n            fontSize: \"small\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 445,\n            columnNumber: 61\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 445,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(Paper, {\n          elevation: 1,\n          sx: {\n            p: 1,\n            borderRadius: 1,\n            maxWidth: '70%',\n            bgcolor: 'background.paper',\n            color: 'text.primary'\n          },\n          children: [/*#__PURE__*/_jsxDEV(CircularProgress, {\n            size: 20\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 453,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(Typography, {\n            variant: \"body2\",\n            sx: {\n              mt: 1\n            },\n            children: \"\\u6B63\\u5728\\u601D\\u8003\\u4E2D\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 454,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 446,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 440,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        ref: messagesEndRef\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 458,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 314,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(Box, {\n      sx: {\n        p: 2,\n        borderTop: '1px solid',\n        borderColor: 'divider',\n        display: 'flex',\n        alignItems: 'flex-end',\n        gap: 1\n      },\n      children: [/*#__PURE__*/_jsxDEV(TextField, {\n        fullWidth: true,\n        multiline: true,\n        maxRows: 4,\n        value: inputValue,\n        onChange: e => setInputValue(e.target.value),\n        onKeyPress: handleKeyPress,\n        placeholder: \"\\u8F93\\u5165\\u60A8\\u7684\\u95EE\\u9898...\\u4F8B\\u5982\\uFF1A\\u5206\\u6790\\u4E59\\u9187\\u5206\\u5B50\\u7684\\u6027\\u8D28\",\n        variant: \"outlined\",\n        size: \"small\",\n        disabled: isLoading,\n        inputRef: textareaRef,\n        sx: {\n          flexGrow: 1\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 462,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Button, {\n        variant: \"contained\",\n        endIcon: /*#__PURE__*/_jsxDEV(SendIcon, {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 478,\n          columnNumber: 20\n        }, this),\n        onClick: handleSubmit,\n        disabled: !inputValue.trim() || isLoading,\n        sx: {\n          height: '40px'\n        } // Adjust height to match TextField\n        ,\n        children: \"\\u53D1\\u9001\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 476,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 461,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 290,\n    columnNumber: 5\n  }, this);\n};\n_s2(ChatWindow, \"TPGmSkwyAuVuYeCns7jgHuWVsYA=\");\n_c2 = ChatWindow;\nexport default ChatWindow;\nvar _c, _c2;\n$RefreshReg$(_c, \"ToolOutputContent\");\n$RefreshReg$(_c2, \"ChatWindow\");","map":{"version":3,"names":["React","useState","useRef","useEffect","Box","TextField","Button","Typography","CircularProgress","Paper","Avatar","Chip","SendIcon","SmartToyIcon","PersonIcon","ErrorOutlineIcon","InfoOutlinedIcon","ExpandMoreIcon","ExpandLessIcon","ReactMarkdown","remarkMath","rehypeKatex","ToolCallDisplay","sendMessage","jsxDEV","_jsxDEV","Fragment","_Fragment","MAX_TOOL_OUTPUT_LENGTH","groupAgentSteps","steps","grouped","currentGroup","forEach","step","type","tool_calls","length","tool_output","push","thought","content","concat","output","ToolOutputContent","_s","showFull","setShowFull","isLong","displayedOutput","substring","children","component","sx","mt","fileName","_jsxFileName","lineNumber","columnNumber","onClick","size","endIcon","_c","ChatWindow","conversation","onSendMessage","onUpdateTitle","isLoading","setIsLoading","onUpdateConversationUuid","_s2","inputValue","setInputValue","currentAssistantMessage","setCurrentAssistantMessage","eventSourceRef","messagesEndRef","textareaRef","currentConversationUuid","setCurrentConversationUuid","uuid","scrollToBottom","_messagesEndRef$curre","current","scrollIntoView","behavior","messages","handleKeyPress","e","key","shiftKey","preventDefault","handleSubmit","trim","userMessage","id","Date","now","toString","timestamp","toISOString","title","currentInput","newAssistantMessage","agent_steps","status","close","prev","updatedMessage","conversation_uuid","error","console","message","log","adjustTextareaHeight","textarea","style","height","Math","min","scrollHeight","formatTime","toLocaleTimeString","hour","minute","flexGrow","display","flexDirection","justifyContent","alignItems","p","textAlign","color","fontSize","mb","variant","gutterBottom","maxWidth","overflow","borderBottom","borderColor","available_tools","bgcolor","listStyle","m","map","tool","index","label","function","name","description","overflowY","mr","elevation","borderRadius","stepGroup","groupIndex","toolCalls","JSON","stringify","remarkPlugins","rehypePlugins","icon","ml","ref","borderTop","gap","fullWidth","multiline","maxRows","value","onChange","target","onKeyPress","placeholder","disabled","inputRef","_c2","$RefreshReg$"],"sources":["/Users/wang-work/matagent/frontend/src/components/ChatWindow.js"],"sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\nimport { Box, TextField, Button, Typography, CircularProgress, Paper, Avatar, Chip } from '@mui/material';\nimport SendIcon from '@mui/icons-material/Send';\nimport SmartToyIcon from '@mui/icons-material/SmartToy';\nimport PersonIcon from '@mui/icons-material/Person';\nimport ErrorOutlineIcon from '@mui/icons-material/ErrorOutline';\nimport InfoOutlinedIcon from '@mui/icons-material/InfoOutlined';\nimport ExpandMoreIcon from '@mui/icons-material/ExpandMore';\nimport ExpandLessIcon from '@mui/icons-material/ExpandLess';\nimport ReactMarkdown from 'react-markdown';\nimport remarkMath from 'remark-math';\nimport rehypeKatex from 'rehype-katex';\nimport 'katex/dist/katex.min.css'; // Import KaTeX CSS\nimport ToolCallDisplay from './ToolCallDisplay';\nimport { sendMessage } from '../utils/api'; // Import sendMessage from api.js\n\nconst MAX_TOOL_OUTPUT_LENGTH = 200; // Define max length for tool output display\n\n// Helper function to group agent steps into logical turns\nconst groupAgentSteps = (steps) => {\n  const grouped = [];\n  let currentGroup = null;\n\n  steps.forEach(step => {\n    if (step.type === 'thought') {\n      if (currentGroup && (currentGroup.tool_calls.length > 0 || currentGroup.tool_output)) {\n        grouped.push(currentGroup);\n      }\n      currentGroup = { thought: step.content, tool_calls: [], tool_output: null };\n    } else if (step.type === 'tool_calls') {\n      if (!currentGroup) {\n        currentGroup = { thought: null, tool_calls: [], tool_output: null };\n      }\n      currentGroup.tool_calls = currentGroup.tool_calls.concat(step.content); // step.content is now the tool_calls array\n    } else if (step.type === 'tool_output') {\n      if (!currentGroup) {\n        currentGroup = { thought: null, tool_calls: [], tool_output: null };\n      }\n      currentGroup.tool_output = step.content.output; // step.content is now the tool_output object\n      grouped.push(currentGroup); // Tool output usually marks the end of a step\n      currentGroup = null; // Reset for next group\n    } else if (step.type === 'final_answer') {\n      if (currentGroup) {\n        grouped.push(currentGroup);\n      }\n      // Final answer is handled separately, not grouped as a step\n    }\n  });\n\n  if (currentGroup) {\n    grouped.push(currentGroup);\n  }\n  return grouped;\n};\n\nconst ToolOutputContent = ({ output }) => {\n  const [showFull, setShowFull] = useState(false);\n  const isLong = output && output.length > MAX_TOOL_OUTPUT_LENGTH;\n  const displayedOutput = isLong && !showFull ? output.substring(0, MAX_TOOL_OUTPUT_LENGTH) + '...' : output;\n\n  return (\n    <>\n      <Typography component=\"div\" sx={{ mt: 1 }}>\n        <ReactMarkdown>{displayedOutput}</ReactMarkdown>\n      </Typography>\n      {isLong && (\n        <Button \n          onClick={() => setShowFull(!showFull)}\n          size=\"small\"\n          endIcon={showFull ? <ExpandLessIcon /> : <ExpandMoreIcon />}\n          sx={{ mt: 0.5 }} // Adjusted margin top for consistency\n        >\n          {showFull ? 'Show Less' : 'Show More'}\n        </Button>\n      )}\n    </>\n  );\n};\n\nconst ChatWindow = ({\n  conversation,\n  onSendMessage,\n  onUpdateTitle,\n  isLoading,\n  setIsLoading,\n  onUpdateConversationUuid // New prop to update conversation_uuid\n}) => {\n  const [inputValue, setInputValue] = useState('');\n  const [currentAssistantMessage, setCurrentAssistantMessage] = useState(null);\n  const eventSourceRef = useRef(null); // To store the EventSource instance\n  const messagesEndRef = useRef(null);\n  const textareaRef = useRef(null);\n  const [currentConversationUuid, setCurrentConversationUuid] = useState(conversation?.uuid || null); // New state for conversation_uuid\n\n  useEffect(() => {\n    if (conversation?.uuid) {\n      setCurrentConversationUuid(conversation.uuid);\n    }\n  }, [conversation?.uuid]);\n\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  };\n\n  useEffect(() => {\n    scrollToBottom();\n  }, [conversation?.messages, currentAssistantMessage]);\n\n  const handleKeyPress = (e) => {\n    if (e.key === 'Enter' && !e.shiftKey) {\n      e.preventDefault();\n      handleSubmit(e);\n    }\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    if (!inputValue.trim() || isLoading || !conversation) return;\n\n    const userMessage = {\n      id: Date.now().toString(),\n      type: 'user',\n      content: inputValue.trim(),\n      timestamp: new Date().toISOString()\n    };\n\n    onSendMessage(conversation.id, userMessage);\n\n    if (conversation.messages.length === 0) {\n      const title = inputValue.trim().length > 30\n        ? inputValue.trim().substring(0, 30) + '...'\n        : inputValue.trim();\n      onUpdateTitle(conversation.id, title);\n    }\n\n    const currentInput = inputValue;\n    setInputValue('');\n    setIsLoading(true);\n\n    // Initialize a new assistant message for streaming\n    const newAssistantMessage = {\n      id: (Date.now() + 1).toString(),\n      type: 'assistant',\n      content: '',\n      timestamp: new Date().toISOString(),\n      agent_steps: [],\n      status: 'pending',\n    };\n    setCurrentAssistantMessage(newAssistantMessage);\n\n    // Close any existing EventSource connection before starting a new one\n    if (eventSourceRef.current) {\n      eventSourceRef.current.close();\n    }\n\n    try {\n      eventSourceRef.current = sendMessage(\n        currentInput,\n        currentConversationUuid,\n        (step) => { // onNewStep callback\n          setCurrentAssistantMessage(prev => {\n            // Ensure prev is not null before spreading\n            const updatedMessage = prev ? { ...prev } : {\n              id: (Date.now() + 1).toString(),\n              type: 'assistant',\n              content: '',\n              timestamp: new Date().toISOString(),\n              agent_steps: [],\n              status: 'pending',\n            };\n\n            if (step.type === 'conversation_info') {\n              if (step.conversation_uuid) {\n                setCurrentConversationUuid(step.conversation_uuid);\n                onUpdateConversationUuid(conversation.id, step.conversation_uuid);\n              }\n            } else if (step.type === 'text_chunk') {\n              updatedMessage.content += step.content;\n            } else if (step.type === 'final_answer') {\n              updatedMessage.content = step.content;\n              updatedMessage.status = 'success';\n            } else if (step.type === 'error') {\n              updatedMessage.content = step.content;\n              updatedMessage.status = 'error';\n            } else if (step.type === 'end') {\n              // This marks the end of the stream\n              updatedMessage.status = updatedMessage.status === 'error' ? 'error' : 'success'; // Preserve error status if any\n              setIsLoading(false);\n              if (eventSourceRef.current) {\n                eventSourceRef.current.close();\n              }\n            } else {\n              // For thought, tool_calls, tool_output, append to agent_steps\n              updatedMessage.agent_steps = [...updatedMessage.agent_steps, step];\n            }\n            return updatedMessage;\n          });\n        },\n        (error) => { // onError callback\n          console.error('Error during streaming message:', error);\n          setCurrentAssistantMessage(prev => ({\n            ...prev,\n            content: `抱歉，发生了错误：${error.message || '未知错误'}。请稍后再试。`,\n            status: 'error',\n          }));\n          setIsLoading(false); // Stop loading on error\n        },\n        () => { // onOpen callback\n          // Optional: handle connection open\n          console.log('SSE connection opened successfully.');\n        }\n      );\n    } catch (error) {\n      console.error('Error initiating streaming message:', error);\n      setCurrentAssistantMessage(prev => ({\n        ...prev,\n        content: `抱歉，无法启动对话：${error.message || '未知错误'}。请稍后再试。`,\n        status: 'error',\n      }));\n      setIsLoading(false);\n    } finally {\n      // The EventSource will be closed by the onError or when the stream naturally ends.\n      // We set isLoading to false when the 'end' signal is received or on error.\n      // The 'end' signal handling needs to be inside onNewStep for type 'end'.\n    }\n  };\n\n  // Effect to close EventSource when component unmounts\n  useEffect(() => {\n    return () => {\n      if (eventSourceRef.current) {\n        eventSourceRef.current.close();\n      }\n    };\n  }, []);\n\n  // Effect to add the completed assistant message to conversation messages\n  useEffect(() => {\n    // Only add if currentAssistantMessage exists, is not loading, and has a final status\n    if (currentAssistantMessage && !isLoading && (currentAssistantMessage.status === 'success' || currentAssistantMessage.status === 'error')) {\n      onSendMessage(conversation.id, currentAssistantMessage);\n      setCurrentAssistantMessage(null); // Clear current message\n    }\n  }, [isLoading, currentAssistantMessage, conversation, onSendMessage]);\n\n  const adjustTextareaHeight = () => {\n    const textarea = textareaRef.current;\n    if (textarea) {\n      textarea.style.height = 'auto';\n      textarea.style.height = Math.min(textarea.scrollHeight, 120) + 'px';\n    }\n  };\n\n  useEffect(() => {\n    adjustTextareaHeight();\n  }, [inputValue]);\n\n  const formatTime = (timestamp) => {\n    return new Date(timestamp).toLocaleTimeString('zh-CN', {\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  };\n\n  if (!conversation) {\n    return (\n      <Box sx={{\n        flexGrow: 1,\n        display: 'flex',\n        flexDirection: 'column',\n        justifyContent: 'center',\n        alignItems: 'center',\n        p: 3,\n        textAlign: 'center',\n        color: 'text.secondary',\n      }}>\n        <SmartToyIcon sx={{ fontSize: 80, mb: 2 }} />\n        <Typography variant=\"h5\" component=\"h3\" gutterBottom>\n          欢迎使用 BioaGen Agent\n        </Typography>\n        <Typography variant=\"body1\" sx={{ maxWidth: 500 }}>\n          这是一个基于AI的生物分子分析助手。您可以询问有关分子结构、性质预测、\n          化学反应等相关问题。点击左侧\"新建对话\"开始您的分析之旅。\n        </Typography>\n      </Box>\n    );\n  }\n\n  return (\n    <Box sx={{\n      flexGrow: 1,\n      display: 'flex',\n      flexDirection: 'column',\n      height: '100%',\n      overflow: 'hidden',\n    }}>\n      <Box sx={{ p: 2, borderBottom: '1px solid', borderColor: 'divider' }}>\n        <Typography variant=\"h6\">{conversation.title}</Typography>\n      </Box>\n\n      {conversation.available_tools && conversation.available_tools.length > 0 && (\n        <Box sx={{ p: 2, bgcolor: 'action.hover', borderBottom: '1px solid', borderColor: 'divider' }}>\n          <Typography variant=\"subtitle2\" gutterBottom>Available Tools:</Typography>\n          <Box component=\"ul\" sx={{ listStyle: 'none', p: 0, m: 0 }}>\n            {conversation.available_tools.map((tool, index) => (\n              <li key={index}>\n                <Chip label={`${tool.function.name}: ${tool.function.description}`} size=\"small\" sx={{ mb: 0.5 }} />\n              </li>\n            ))}\n          </Box>\n        </Box>\n      )}\n\n      <Box sx={{ flexGrow: 1, overflowY: 'auto', p: 2 }}>\n        {conversation.messages.map((message) => (\n          <Box key={message.id} sx={{\n            display: 'flex',\n            mb: 2,\n            justifyContent: message.type === 'user' ? 'flex-end' : 'flex-start',\n          }}>\n            {message.type === 'assistant' && (\n              <Avatar sx={{ bgcolor: 'primary.main', mr: 1 }}><SmartToyIcon fontSize=\"small\" /></Avatar>\n            )}\n            <Paper elevation={1} sx={{\n              p: 1,\n              borderRadius: 1,\n              maxWidth: '70%',\n              bgcolor: message.type === 'user' ? 'primary.light' : 'background.paper',\n              color: message.type === 'user' ? 'primary.contrastText' : 'text.primary',\n            }}>\n              {message.agent_steps && message.agent_steps.length > 0 && (\n                <Box sx={{ mb: 1 }}>\n                  {groupAgentSteps(message.agent_steps).map((stepGroup, groupIndex) => (\n                    <Box key={groupIndex} sx={{ mb: 1, p: 1, bgcolor: 'grey.50', borderRadius: 1 }}>\n                      <Typography variant=\"subtitle2\">步骤 {groupIndex + 1}</Typography>\n                      {stepGroup.thought && (\n                        <Typography variant=\"body2\" sx={{ mt: 0.5 }}>\n                          <strong>Agent Thought:</strong> <ReactMarkdown>{stepGroup.thought}</ReactMarkdown>\n                        </Typography>\n                      )}\n                      {stepGroup.tool_calls && stepGroup.tool_calls.length > 0 && (\n                        <Box sx={{ mt: 0.5 }}>\n                          <Typography variant=\"body2\"><strong>Tool Calls:</strong></Typography>\n                          <ToolCallDisplay toolCalls={stepGroup.tool_calls} />\n                        </Box>\n                      )}\n                      {stepGroup.tool_output && (\n                        <Box sx={{ mt: 0.5 }}>\n                          <Typography variant=\"body2\"><strong>Tool Output:</strong></Typography>\n                          <ToolOutputContent output={JSON.stringify(stepGroup.tool_output)} />\n                        </Box>\n                      )}\n                    </Box>\n                  ))}\n                </Box>\n              )}\n              <Typography component=\"div\">\n                <ReactMarkdown\n                  remarkPlugins={[remarkMath]}\n                  rehypePlugins={[rehypeKatex]}\n                >{message.content}</ReactMarkdown>\n              </Typography>\n\n              {/* Display status indicator */}\n              {message.status && message.status !== 'success' && (\n                <Chip\n                  icon={message.status === 'error' ? <ErrorOutlineIcon /> : <InfoOutlinedIcon />}\n                  label={message.status === 'error' ? '执行失败' : '部分成功'}\n                  size=\"small\"\n                  color={message.status === 'error' ? 'error' : 'warning'}\n                  sx={{ mt: 1 }}\n                />\n              )}\n\n              <Typography variant=\"caption\" color=\"text.secondary\" sx={{ display: 'block', mt: 0.5 }}>\n                {formatTime(message.timestamp)}\n              </Typography>\n            </Paper>\n            {message.type === 'user' && (\n              <Avatar sx={{ bgcolor: 'secondary.main', ml: 1 }}><PersonIcon fontSize=\"small\" /></Avatar>\n            )}\n          </Box>\n        ))}\n\n        {/* Display the current streaming message */}\n        {currentAssistantMessage && (\n          <Box sx={{\n            display: 'flex',\n            mb: 2,\n            justifyContent: 'flex-start',\n          }}>\n            <Avatar sx={{ bgcolor: 'primary.main', mr: 1 }}><SmartToyIcon fontSize=\"small\" /></Avatar>\n            <Paper elevation={1} sx={{\n              p: 1,\n              borderRadius: 1,\n              maxWidth: '70%',\n              bgcolor: 'background.paper',\n              color: 'text.primary',\n            }}>\n              {currentAssistantMessage.agent_steps && currentAssistantMessage.agent_steps.length > 0 && (\n                <Box sx={{ mb: 1 }}>\n                  {groupAgentSteps(currentAssistantMessage.agent_steps).map((stepGroup, groupIndex) => (\n                    <Box key={groupIndex} sx={{ mb: 1, p: 1, bgcolor: 'grey.50', borderRadius: 1 }}>\n                      <Typography variant=\"subtitle2\">步骤 {groupIndex + 1}</Typography>\n                      {stepGroup.thought && (\n                        <Typography variant=\"body2\" sx={{ mt: 0.5 }}>\n                          <strong>Agent Thought:</strong> <ReactMarkdown>{stepGroup.thought}</ReactMarkdown>\n                        </Typography>\n                      )}\n                      {stepGroup.tool_calls && stepGroup.tool_calls.length > 0 && (\n                        <Box sx={{ mt: 0.5 }}>\n                          <Typography variant=\"body2\"><strong>Tool Calls:</strong></Typography>\n                          <ToolCallDisplay toolCalls={stepGroup.tool_calls} />\n                        </Box>\n                      )}\n                      {stepGroup.tool_output && (\n                        <Box sx={{ mt: 0.5 }}>\n                          <Typography variant=\"body2\"><strong>Tool Output:</strong></Typography>\n                          <ToolOutputContent output={JSON.stringify(stepGroup.tool_output)} />\n                        </Box>\n                      )}\n                    </Box>\n                  ))}\n                </Box>\n              )}\n              <Typography component=\"div\">\n                <ReactMarkdown\n                  remarkPlugins={[remarkMath]}\n                  rehypePlugins={[rehypeKatex]}\n                >{currentAssistantMessage.content}</ReactMarkdown>\n              </Typography>\n              {isLoading && (\n                <CircularProgress size={20} sx={{ mt: 1 }} />\n              )}\n            </Paper>\n          </Box>\n        )}\n\n        {isLoading && !currentAssistantMessage && (\n          <Box sx={{\n            display: 'flex',\n            mb: 2,\n            justifyContent: 'flex-start',\n          }}>\n            <Avatar sx={{ bgcolor: 'primary.main', mr: 1 }}><SmartToyIcon fontSize=\"small\" /></Avatar>\n            <Paper elevation={1} sx={{\n              p: 1,\n              borderRadius: 1,\n              maxWidth: '70%',\n              bgcolor: 'background.paper',\n              color: 'text.primary',\n            }}>\n              <CircularProgress size={20} />\n              <Typography variant=\"body2\" sx={{ mt: 1 }}>正在思考中</Typography>\n            </Paper>\n          </Box>\n        )}\n        <div ref={messagesEndRef} />\n      </Box>\n\n      <Box sx={{ p: 2, borderTop: '1px solid', borderColor: 'divider', display: 'flex', alignItems: 'flex-end', gap: 1 }}>\n        <TextField\n          fullWidth\n          multiline\n          maxRows={4}\n          value={inputValue}\n          onChange={(e) => setInputValue(e.target.value)}\n          onKeyPress={handleKeyPress}\n          placeholder=\"输入您的问题...例如：分析乙醇分子的性质\"\n          variant=\"outlined\"\n          size=\"small\"\n          disabled={isLoading}\n          inputRef={textareaRef}\n          sx={{ flexGrow: 1 }}\n        />\n        <Button\n          variant=\"contained\"\n          endIcon={<SendIcon />}\n          onClick={handleSubmit}\n          disabled={!inputValue.trim() || isLoading}\n          sx={{ height: '40px' }} // Adjust height to match TextField\n        >\n          发送\n        </Button>\n      </Box>\n    </Box>\n  );\n};\n\nexport default ChatWindow;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}